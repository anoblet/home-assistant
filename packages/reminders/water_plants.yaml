# Water Plants Reminder Package
plants_water_reminder:
  # Switch to control reminder state
  switch:
    - platform: template
      switches:
        water_plants_reminder:
          friendly_name: "Water Plants Reminder"
          icon_template: "mdi:flower"
          value_template: "{{ is_state('input_boolean.water_plants_reminder_state', 'on') }}"
          turn_on:
            service: input_boolean.turn_on
            target:
              entity_id: input_boolean.water_plants_reminder_state
          turn_off:
            service: input_boolean.turn_off
            target:
              entity_id: input_boolean.water_plants_reminder_state

  # Helper entities
  input_boolean:
    water_plants_reminder_state:
      name: Water Plants Reminder State
      initial: false

  # Automations
  automation:
    # Create reminder for 1st and 15th of month
    - alias: "Set Water Plants Reminder on 1st and 15th"
      trigger:
        - platform: time_pattern
          hours: "8"
          minutes: "0"
      condition:
        - condition: template
          value_template: "{{ now().day == 1 or now().day == 15 }}"
        - condition: state
          entity_id: input_boolean.water_plants_reminder_state
          state: "off"
      action:
        - service: input_boolean.turn_on
          target:
            entity_id: input_boolean.water_plants_reminder_state
        - service: notify.mobile_app
          data:
            title: "Time to Water Plants"
            message: "It's time to water your plants!"
            data:
              actions:
                - action: "WATER_PLANTS_DONE"
                  title: "Mark as Complete"
                - action: "WATER_PLANTS_SNOOZE"
                  title: "Snooze"

    # Daily reminder if not completed
    - alias: "Daily Water Plants Reminder"
      trigger:
        - platform: time
          at: "08:00:00"
      condition:
        - condition: state
          entity_id: input_boolean.water_plants_reminder_state
          state: "on"
      action:
        - service: notify.mobile_app
          data:
            title: "Reminder: Water Plants"
            message: "Please remember to water your plants today!"
            data:
              actions:
                - action: "WATER_PLANTS_DONE"
                  title: "Mark as Complete"
                - action: "WATER_PLANTS_SNOOZE"
                  title: "Snooze"

    # Handle "Complete" action
    - alias: "Water Plants Marked as Complete"
      trigger:
        - platform: event
          event_type: mobile_app_notification_action
          event_data:
            action: WATER_PLANTS_DONE
      action:
        - service: input_boolean.turn_off
          target:
            entity_id: input_boolean.water_plants_reminder_state
        - service: notify.mobile_app
          data:
            title: "Plants Watered"
            message: "Great job! Your plants thank you."

    # Handle "Snooze" action
    - alias: "Water Plants Reminder Snoozed"
      trigger:
        - platform: event
          event_type: mobile_app_notification_action
          event_data:
            action: WATER_PLANTS_SNOOZE
      action:
        - service: notify.mobile_app
          data:
            title: "Reminder Snoozed"
            message: "You'll be reminded again tomorrow."
